{{/*
Create a Secret containing a single file `nifi-secret.properties` built from
the map in `.Values.nifi-secret-properties`. Each map entry becomes a
`key=value` line in the properties file.
*/}}
{{- if index .Values "nifi-cluster" "cluster" "nifiProperties" "overrideSecretConfig" }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ index .Values "nifi-cluster" "cluster" "nifiProperties" "overrideSecretConfig" "name" }}
  labels:
{{- if (hasKey . "Chart") }}
    {{- include "common.labels.standard" . | nindent 4 }}
{{- else }}
    app: {{ index .Values "nifi-cluster" "cluster" "nifiProperties" "overrideSecretConfig" "name" }}
{{- end }}
type: Opaque
stringData:
  nifi-secret.properties: |-
{{- if index .Values "nifi-secret-properties" }}
{{- range $key, $value := index .Values "nifi-secret-properties" }}
{{ printf "%s=%s" $key $value | indent 4 }}
{{- end }}
{{- else }}
{{- "" | indent 4 }}
{{- end }}
{{- end }}
